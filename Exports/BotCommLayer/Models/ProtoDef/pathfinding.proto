syntax = "proto3";

package pathfinding;
option csharp_namespace = "Pathfinding";

import "game.proto";

// Main request message
message PathfindingRequest {
    oneof payload {
        CalculatePathRequest path = 1;
        LineOfSightRequest los = 2;
        PhysicsInput step = 3;
        VMapHeightRequest vmap_height = 4;
        VMapLineOfSightRequest vmap_los = 5;
        CombinedLineOfSightRequest combined_los = 6;
        AreaInfoRequest area_info = 7;
        LiquidInfoRequest liquid_info = 8;
    }
}

// Main response message
message PathfindingResponse {
    oneof payload {
        CalculatePathResponse path = 1;
        LineOfSightResponse los = 2;
        PhysicsOutput step = 3;
        VMapHeightResponse vmap_height = 4;
        VMapLineOfSightResponse vmap_los = 5;
        CombinedLineOfSightResponse combined_los = 6;
        AreaInfoResponse area_info = 7;
        LiquidInfoResponse liquid_info = 8;
        Error error = 99;
    }
}

// Error message
message Error {
    string message = 1;
}

// Navigation mesh pathfinding
message CalculatePathRequest {
    uint32 map_id = 1;
    game.Position start = 2;
    game.Position end = 3;
    bool straight = 4;
}

message CalculatePathResponse {
    repeated game.Position corners = 1;
}

// Navigation mesh line of sight
message LineOfSightRequest {
    uint32 map_id = 1;
    game.Position from = 2;
    game.Position to = 3;
}

message LineOfSightResponse {
    bool in_los = 1;
}

// Physics system
message PhysicsInput {
    // Movement state
    uint32 movement_flags = 1;
    
    // Position & orientation
    float pos_x = 2;
    float pos_y = 3;
    float pos_z = 4;
    float facing = 5;
    
    // Transport
    uint64 transport_guid = 6;
    float transport_offset_x = 7;
    float transport_offset_y = 8;
    float transport_offset_z = 9;
    float transport_orientation = 10;
    
    // Swimming/flying
    float swim_pitch = 11;
    
    // Falling/jumping - simplified
    uint32 fall_time = 12;
    // REMOVED: jump_vertical_speed, jump_cos_angle, jump_sin_angle, jump_horizontal_speed
    // These are now handled by velocity components (vel_x, vel_y, vel_z)
    
    // Spline
    float spline_elevation = 13;
    
    // Movement speeds
    float walk_speed = 14;
    float run_speed = 15;
    float run_back_speed = 16;
    float swim_speed = 17;
    float swim_back_speed = 18;
    
    // Current velocity
    float vel_x = 19;
    float vel_y = 20;
    float vel_z = 21;
    
    // Collision
    float radius = 22;
    float height = 23;
    float gravity = 24;
    
    // Context
    uint32 map_id = 25;
    float delta_time = 26;
}

message PhysicsOutput {
    // New position
    float new_pos_x = 1;
    float new_pos_y = 2;
    float new_pos_z = 3;
    
    // New velocity
    float new_vel_x = 4;
    float new_vel_y = 5;
    float new_vel_z = 6;
    
    // Updated state
    uint32 movement_flags = 7;
    float orientation = 8;
    float pitch = 9;
    
    // Status flags
    bool is_grounded = 10;
    bool is_swimming = 11;
    bool is_flying = 12;
    
    // Fall time tracking
    uint32 fall_time = 13;
}

// VMAP height query
message VMapHeightRequest {
    uint32 map_id = 1;
    game.Position position = 2;
    float max_search_dist = 3;
}

message VMapHeightResponse {
    float height = 1;
    bool found = 2;
}

// VMAP line of sight
message VMapLineOfSightRequest {
    uint32 map_id = 1;
    game.Position from = 2;
    game.Position to = 3;
}

message VMapLineOfSightResponse {
    bool in_los = 1;
}

// Combined line of sight (NavMesh + VMAP)
message CombinedLineOfSightRequest {
    uint32 map_id = 1;
    game.Position from = 2;
    game.Position to = 3;
}

message CombinedLineOfSightResponse {
    bool navmesh_los = 1;
    bool vmap_los = 2;
    bool combined_los = 3;
}

// Area/zone information
message AreaInfoRequest {
    uint32 map_id = 1;
    game.Position position = 2;
}

message AreaInfoResponse {
    uint32 area_id = 1;
    uint32 zone_id = 2;
    bool found = 3;
}

// Liquid information
message LiquidInfoRequest {
    uint32 map_id = 1;
    game.Position position = 2;
}

message LiquidInfoResponse {
    float liquid_level = 1;
    uint32 liquid_type = 2;
    bool has_liquid = 3;
}